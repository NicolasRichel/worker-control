<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Worker Creator</title>
    <link rel="icon" href="./web-components-logo.png"/>
    <script defer type="text/javascript" src="./utils.js"></script>
    <script defer type="module" src="./custom-elements.js"></script>
    <style>
      div { margin: 0; padding: 16px 48px; }
      textarea { width: 320px; height: 160px; resize: none; }
    </style>
  </head>
  <body>
    <h1>Worker Creator Test</h1>
    <div>
      This button is a Worker Creator: <worker-creator src="./workers/worker.js">Create Worker</worker-creator>
      <!-- This button is a Worker Creator: <button id="creator" is="worker-creator" src="./workers/worker.js">Create Worker</button> -->
    </div>
    <div>
      <textarea id="text"></textarea><br/>
      <button onclick="sendMessage();">Send Message to Worker</button>
    </div>
    <div>
      <button onclick="stopWorker();">Stop Worker</button>
    </div>
    <script>
      let worker;

      document.querySelector('worker-creator').addEventListener('worker-created', (e) => {
        // Stop previous worker if any
        if (typeof worker !== 'undefined') {
          worker.terminate();
        }
        // Log new worker UUID
        console.log(`Worker UUID : ${e.detail.id}`);
        // Set the new worker
        worker = e.detail.worker;
      });

      function sendMessage() {
        if (typeof worker !== 'undefined') {
          worker.postMessage(document.getElementById('text').value);
        }
      }

      function stopWorker() {
        if (typeof worker !== 'undefined') {
          worker.terminate();
        }
      }
    </script>
  </body>
</html>
